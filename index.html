
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>æ‰‹æ©ŸæŸ¥è©¢ç³»çµ± SQLite ç‰ˆ</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.js"></script>
  <style>
    body { background-color: #0d0d16; color: white; font-family: sans-serif; text-align: center; padding: 2rem; }
    input { padding: 0.6rem; width: 60%; font-size: 1rem; border-radius: 6px; border: none; margin-bottom: 1rem; }
    button { padding: 0.6rem 1.2rem; font-size: 1rem; margin: 0.2rem; border-radius: 6px; border: none; cursor: pointer; }
    .search-btn { background-color: #4fc1e9; }
    .clear-btn { background-color: #f6a623; }
    .result-box {
      background: #2d2d3a;
      padding: 1rem;
      margin: 0.5rem auto;
      width: 70%;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <h1>ğŸ“± æ‰‹æ©ŸæŸ¥è©¢ç³»çµ±ï¼ˆSQLite é›¢ç·šç‰ˆï¼‰</h1>
  <input type="text" id="searchInput" placeholder="è«‹è¼¸å…¥æ‰‹æ©Ÿé—œéµå­—ï¼Œä¾‹å¦‚ iPhone 256" />
  <br/>
  <button class="search-btn" onclick="search()">æœå°‹</button>
  <button class="clear-btn" onclick="clearSearch()">æ¸…é™¤</button>
  <div id="result" style="margin-top:2rem;"></div>

  <script>
    let db = null;

    // è¼‰å…¥ SQLite è³‡æ–™åº«
    initSqlJs({ locateFile: filename => `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/${filename}` })
      .then(SQL => {
        fetch("mobilequery_data_split.sqlite")
          .then(res => res.arrayBuffer())
          .then(buf => {
            db = new SQL.Database(new Uint8Array(buf));
          });
      });

    function search() {
      const keyword = document.getElementById("searchInput").value.trim().toLowerCase();
      const resultDiv = document.getElementById("result");
      resultDiv.innerHTML = "";

      if (!keyword || !db) return;

      const phones = db.exec(`
        SELECT * FROM phones WHERE LOWER(æ©Ÿå‹) LIKE '%${keyword.replace(/'/g, "''")}%'
      `);

      if (phones.length === 0) {
        resultDiv.innerHTML = "<p>æ‰¾ä¸åˆ°ç¬¦åˆçš„æ‰‹æ©Ÿå‹è™Ÿã€‚</p>";
        return;
      }

      phones[0].values.forEach(([ä»£ç¢¼, æ©Ÿå‹, å–®æ©Ÿåƒ¹, ä¿éšª]) => {
        const planRows = db.exec(`SELECT å°ˆæ¡ˆåƒ¹, ä¾†æºé , ä¾†æºæ¬„ä½ FROM plans WHERE ä»£ç¢¼ = '${ä»£ç¢¼.replace(/'/g, "''")}'`);
        const plans = (planRows.length > 0) ? planRows[0].values : [];

        let html = `
          <div class="result-box">
            <strong>${æ©Ÿå‹}</strong><br/>
            ç©ºæ©Ÿåƒ¹ï¼š${å–®æ©Ÿåƒ¹} å…ƒ<br/>
            ä¿éšªï¼š${ä¿éšª || "ç„¡"}<br/>
            <hr/>
            <strong>å°ˆæ¡ˆåˆ—è¡¨ï¼š</strong><br/>
        `;
        html += plans.map(p => `ğŸ“„ ${p[1]}ï½œ${p[2]}ï¼š<b>${p[0]} å…ƒ</b>`).join("<br/>");
        html += "</div>";
        resultDiv.innerHTML += html;
      });
    }

    function clearSearch() {
      document.getElementById("searchInput").value = "";
      document.getElementById("result").innerHTML = "";
    }
  </script>
</body>
</html>
