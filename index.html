
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>手機價格查詢系統</title>
  <script src="https://cdn.jsdelivr.net/npm/pako@2.1.0/dist/pako.min.js"></script>
  <style>
    body { background-color: #0d0d16; color: white; font-family: sans-serif; text-align: center; padding: 2rem; }
    input { padding: 0.6rem; width: 60%; font-size: 1rem; border-radius: 6px; border: none; margin-bottom: 1rem; }
    button { padding: 0.6rem 1.2rem; font-size: 1rem; margin: 0.2rem; border-radius: 6px; border: none; cursor: pointer; }
    .search-btn { background-color: #4fc1e9; }
    .clear-btn { background-color: #f6a623; }
    #update-time { color: yellow; margin-bottom: 1rem; }
    .result-box { background: #2d2d3a; padding: 1rem; margin: 0.5rem auto; width: 70%; border-radius: 8px; }
  </style>
</head>
<body>
  <h1>手機價格查詢系統</h1>
  <div id="update-time">資料更新時間：載入中...</div>
  <input type="text" id="searchInput" placeholder="請輸入手機名稱，例如：iPhone 256" />
  <br/>
  <button class="search-btn" onclick="search()">搜尋</button>
  <button class="clear-btn" onclick="clearSearch()">清除</button>
  <div id="result" style="margin-top:2rem;"></div>

  <script>
    let rawData = [];

    fetch("metadata.json")
      .then(res => res.json())
      .then(data => {
        document.getElementById("update-time").textContent = "資料更新時間：" + (data.updated_at || "未知");
      }).catch(() => {
        document.getElementById("update-time").textContent = "資料更新時間：無法載入";
      });

    fetch("mobilequery_data.json.gz")
      .then(res => res.arrayBuffer())
      .then(buffer => {
        const compressed = new Uint8Array(buffer);
        const text = pako.inflate(compressed, { to: "string" });
        const json = JSON.parse(text);
        rawData = json.data || [];
      })
      .catch(() => {
        document.getElementById("result").innerHTML = "<p style='color:red;'>無法載入資料庫</p>";
      });

    function search() {
      const keyword = document.getElementById("searchInput").value.trim().toLowerCase();
      const resultDiv = document.getElementById("result");
      resultDiv.innerHTML = "";

      if (!keyword) return;

      const results = rawData.filter(item =>
        Object.values(item).some(val => val && val.toLowerCase().includes(keyword))
      );

      if (results.length === 0) {
        resultDiv.innerHTML = "<p>找不到符合的手機型號。</p>";
        return;
      }

      results.forEach(row => {
        const div = document.createElement("div");
        div.className = "result-box";
        div.innerHTML = `
          <strong>${row["機型"]}</strong><br/>
          空機價：${row["單機價"]} 元<br/>
          專案價：${row["專案價"]} 元<br/>
          保險：${row["保險"] || "無"}
        `;
        resultDiv.appendChild(div);
      });
    }

    function clearSearch() {
      document.getElementById("searchInput").value = "";
      document.getElementById("result").innerHTML = "";
    }
  </script>
</body>
</html>
